# Исправление ошибки перезапуска после обновления

## Проблема
При автоматическом перезапуске приложения после обновления возникала ошибка:
```
ModuleNotFoundError: No module named '_sqlite3'
```

## Внесенные изменения

### 1. Обновлен SalaryReader.spec
- Добавлены импорты для sqlite3:
  - `sqlite3`
  - `sqlalchemy.dialects.sqlite`
  - `sqlalchemy.dialects.sqlite.pysqlite`
  - `salary_reader.restart_helper`

### 2. Улучшен src/salary_reader/core/database.py
- Добавлена проверка доступности sqlite3 при импорте
- Добавлена диагностика для PyInstaller bundle
- Улучшена обработка ошибок

### 3. Создан src/salary_reader/restart_helper.py
- Новый модуль для надежного перезапуска приложения
- Использует bat файл для перезапуска (решает проблемы с путями)
- Включает fallback механизм

### 4. Обновлен src/salary_reader/main.py
- Заменена логика перезапуска на использование restart_helper
- Добавлена лучшая обработка ошибок

## Инструкция по тестированию

### 1. Пересборка приложения
```bash
# Удалите старые файлы сборки
rm -rf build/ dist/

# Пересоберите приложение
pyinstaller SalaryReader.spec
```

### 2. Тестирование обновления
1. Запустите приложение из папки `dist/`
2. Нажмите кнопку "Проверить обновления"
3. Если есть обновление, нажмите "Да" для скачивания
4. После установки приложение должно перезапуститься без ошибок

### 3. Проверка логов
Проверьте файл логов на наличие сообщений:
- "Приложение будет перезапущено" - успешный перезапуск
- "Ошибка при перезапуске приложения" - проблемы с перезапуском

## Дополнительные рекомендации

### Если проблема сохраняется:
1. Убедитесь, что в системе установлен sqlite3.dll
2. Проверьте, что все зависимости включены в сборку
3. Рассмотрите возможность добавления sqlite3.dll в папку с приложением

### Альтернативное решение:
Если проблема все еще возникает, можно использовать более простой подход:
- Вместо автоматического перезапуска показывать сообщение пользователю
- Просить пользователя перезапустить приложение вручную
